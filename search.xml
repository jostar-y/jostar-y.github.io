<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>todo</title>
    <url>/2021/04/15/todo/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Todoâ€¦</p>
<span id="more"></span>

<h4 id="Erlang"><a href="#Erlang" class="headerlink" title="Erlang"></a>Erlang</h4><p>gc</p>
<p>rika</p>
<p>hot_reload</p>
<p>cluster</p>
<p>node</p>
<p>io:user</p>
<p>binary</p>
<h4 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h4><h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p>ä¸»ä»</p>
<h4 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h4><p>tcp</p>
<p>udp</p>
<p>http</p>
<p>mqtt</p>
<p>coap</p>
]]></content>
  </entry>
  <entry>
    <title>å®‰è£… erlang</title>
    <url>/2021/04/22/%E5%AE%89%E8%A3%85erlang/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><p><a href="http://erlang.org/download/">ä¸‹è½½é“¾æ¥</a></p>
<p>åˆ†ä¸º win32 å’Œ win64 ä¸¤ç±»ï¼Œé€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ä¸‹è½½å®‰è£…å³å¯ã€‚</p>
<h4 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h4><span id="more"></span>

<ul>
<li>å®‰è£… perl</li>
</ul>
<figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install perl-devel.x86_64</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>å®‰è£…ä¾èµ–æ¨¡å—</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel </span><br></pre></td></tr></tbody></table></figure></li>
<li><p>ä¸‹è½½ erlang æºç å‹ç¼©åŒ…</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">wget http://erlang.org/download/otp_src_23.3.tar.gz </span><br></pre></td></tr></tbody></table></figure></li>
<li><p>è§£å‹ otp_src_23.3.tar.gz </p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">tar -vxf otp_src_23.3.tar.gz </span><br></pre></td></tr></tbody></table></figure></li>
<li><p>è®¾ç½®å®‰è£…è·¯å¾„å¹¶å®‰è£…</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">mkdir /root/erlang_23_3</span><br><span class="line">cd otp_src_23.3</span><br><span class="line">./configure --prefix=/root/erlang_23_3</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="Debian-10"><a href="#Debian-10" class="headerlink" title="Debian 10"></a>Debian 10</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">wget https://packages.erlang-solutions.com/erlang-solutions_2.0_all.deb</span><br><span class="line">sudo dpkg -i erlang-solutions_2.0_all.deb</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install erlang=1:23.3.1-1</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Ubuntu-20-04-LTS"><a href="#Ubuntu-20-04-LTS" class="headerlink" title="Ubuntu 20.04 LTS"></a>Ubuntu 20.04 LTS</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">wget -O- https://packages.erlang-solutions.com/ubuntu/erlang_solutions.asc | sudo apt-key add -</span><br><span class="line">echo "deb https://packages.erlang-solutions.com/ubuntu focal contrib" | sudo tee /etc/apt/sources.list.d/erlang-solution.list</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install erlang=1:23.3.1-1</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Mac"><a href="#Mac" class="headerlink" title="Mac"></a>Mac</h4><figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">brew install erlang</span><br></pre></td></tr></tbody></table></figure>]]></content>
      <tags>
        <tag>erlang</tag>
      </tags>
  </entry>
  <entry>
    <title>rebar</title>
    <url>/2021/04/15/rebar/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script>]]></content>
  </entry>
  <entry>
    <title>lager</title>
    <url>/2021/04/15/lager/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>Lager æ˜¯ erlang å’Œ exlir çš„ä¸€ä¸ªæ—¥å¿—åº“ã€‚</p>
<h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul>
<li><p>ç»†ç²’åº¦æ—¥å¿—çº§åˆ«ï¼ˆ<code>debug, info, notice, warning, error, critical, alert, emergency</code>ï¼‰</p>
</li>
<li><p>è®°å½•å™¨ä½¿ç”¨ <code>parse transform</code> è¿›è¡Œè½¬æ¢ï¼Œä»¥å…è®¸æ•è· <code>Module/Function/Line/Pid</code> ä¿¡æ¯</p>
</li>
<li><p>å½“æ²¡æœ‰å¤„ç†ç¨‹åºæ­£åœ¨ä½¿ç”¨æ—¥å¿—çº§åˆ«æ—¶ (ä¾‹å¦‚ <code>debug</code>)ï¼Œ<code>debug</code> æ—¥å¿—ä¸ä¼šè¢«å‘é€åˆ°æ—¥å¿—å¤„ç†å™¨</p>
</li>
<li><p>æ”¯æŒå¤šä¸ªåç«¯ï¼ŒåŒ…æ‹¬æ§åˆ¶å°å’Œæ–‡ä»¶</p>
</li>
<li><p>æ”¯æŒå¤šä¸ª sink æ‰©å±•</p>
  <span id="more"></span></li>
<li><p>å°†å¸¸è§çš„ OTP é”™è¯¯æ¶ˆæ¯æ”¹å†™ä¸ºæ›´æ˜“è¯»çš„æ¶ˆæ¯</p>
</li>
<li><p>æ”¯æŒåœ¨ç¼–è¯‘æ—¶å¤„ç†è®°å½•ï¼Œå¹¶å¯å®Œæ•´è¾“å‡º</p>
</li>
<li><p>åœ¨é¢å¯¹è¾ƒå¤§æˆ–è¾ƒå¤šçš„æ—¥å¿—æ¶ˆæ¯æ—¶ï¼Œä¸ä¼šå‡ºç°èŠ‚ç‚¹å†…å­˜ä¸è¶³çš„æƒ…å†µ</p>
</li>
<li><p>ç»•è¿‡æ—¥å¿—å¤§å°æˆªæ–­çš„å¯é€‰ç‰¹æ€§ (â€œä¸å®‰å…¨â€)</p>
</li>
<li><p>æ”¯æŒå†…éƒ¨æ—¶é—´å’Œæ—¥æœŸæ—‹è½¬ï¼Œä»¥åŠå¤–éƒ¨æ—‹è½¬å·¥å…·</p>
</li>
<li><p><code>syslog</code> ç±»å‹çš„æ—¥å¿—æ ‡ç­¾</p>
</li>
<li><p>å½©è‰²çš„ç»ˆç«¯è¾“å‡º</p>
</li>
<li><p>æ”¯æŒ <code>map</code></p>
</li>
<li><p>å¯é€‰çš„è´Ÿè½½å‰Šå‡è®¾ç½®é«˜æ°´ä½çº¿ï¼Œæ€æ­» (å¹¶é‡æ–°å¯åŠ¨) ä¸€ä¸ª sink åï¼Œå¯é…ç½®å†·å´å®šæ—¶å™¨</p>
</li>
</ul>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>rebar.config</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{erl_opts,[</span><br><span class="line">    ...</span><br><span class="line">    {parse_transform, lager_transform},     </span><br><span class="line">    {lager_truncation_size, <span class="number">1024</span>},          <span class="comment">% é™åˆ¶å•æ¡æ—¥å¿—æœ€å¤§å°ºå¯¸</span></span><br><span class="line">    {lager_extra_sinks, [audit]},           <span class="comment">% æ‰©å±•æ—¥å¿—</span></span><br><span class="line">    ...</span><br><span class="line">]}.</span><br><span class="line"></span><br><span class="line">{deps,[</span><br><span class="line">       {lager, <span class="string">"3.9.1"</span>}</span><br><span class="line">      ]}</span><br></pre></td></tr></tbody></table></figure>

<p>sys.config</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    {lager_test, []},</span><br><span class="line">    {lager, [</span><br><span class="line"></span><br><span class="line">        {log_root, <span class="string">"./log"</span>},                <span class="comment">% æ—¥å¿—æ ¹ç›®å½•</span></span><br><span class="line">             </span><br><span class="line">        <span class="comment">% {colored, true}					% æ§åˆ¶å°ä½¿ç”¨å½©è‰²è¾“å‡º</span></span><br><span class="line">                </span><br><span class="line">        {crash_log, <span class="string">"crash.log"</span>},           <span class="comment">% è®¾ç½®åå½“ç³»ç»Ÿå‘ç”Ÿä¸¥é‡å´©æºƒæ—¶ï¼Œä¼šå°†æ—¥å¿—è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­</span></span><br><span class="line">        {crash_log_msg_size, <span class="number">65536</span>},        <span class="comment">% å´©æºƒæ—¥å¿—çš„æ¶ˆæ¯å¤§å°çš„é™åˆ¶</span></span><br><span class="line">        {crash_log_size, <span class="number">10485760</span>},         <span class="comment">% å´©æºƒæ—¥å¿—çš„æ–‡ä»¶å¤§å°é™åˆ¶</span></span><br><span class="line">        {crash_log_data, <span class="string">"$D0"</span>},            <span class="comment">% å´©æºƒæ—¥å¿—çš„åˆ‡å‰²æ—¶é—´</span></span><br><span class="line">        {crash_log_count, <span class="number">5</span>},               <span class="comment">% å´©æºƒæ—¥å¿—çš„åˆ‡å‰²æ•°é‡</span></span><br><span class="line"></span><br><span class="line">        {reverse_pretty_stacktrace, true},      <span class="comment">% ç¿»è½¬å †æ ˆè¾“å‡ºé¡ºåº</span></span><br><span class="line">        {error_logger_redirect, true},          <span class="comment">% æ˜¯å¦é‡å®šå‘error_loggeræ¶ˆæ¯</span></span><br><span class="line">        {error_logger_hwm, <span class="number">50</span>},                 <span class="comment">% error_loggeræ¶ˆæ¯çš„é«˜æ°´ä½çº¿ï¼Œè¶…è¿‡å°†è¢«ä¸¢å¼ƒ å¦‚æœæƒ³è¦ç¼“å­˜ä¸€å®šæ•°é‡æ¶ˆæ¯ï¼Œåˆ™å¼€å¯ä¸‹é¢çš„å±æ€§ï¼Œé»˜è®¤ï¼š0</span></span><br><span class="line">        <span class="comment">% {error_logger_flush_queue, true},     % å¼€å¯ä¸¢å¼ƒæ¶ˆæ¯ é»˜è®¤ï¼štrue</span></span><br><span class="line">        <span class="comment">% {error_logger_flush_threshold, 1000}, % å½“æ¶ˆæ¯è¶…è¿‡é«˜æ°´ä½çº¿æ—¶ï¼Œå¹¶ä¸”è¶…è¿‡æ­¤ä¸Šçº¿æ—¶ï¼Œè¶…è¿‡çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒï¼Œé»˜è®¤ï¼š0</span></span><br><span class="line"></span><br><span class="line">        {async_threshold, <span class="number">20</span>},              <span class="comment">% å½“æ—¥å¿—æ¶ˆæ¯ç§¯ç´¯åˆ°ä¸€å®šæ•°é‡æ—¶åˆ‡æ¢åˆ°åŒæ­¥æ¨¡å¼ï¼ˆåå‹ï¼‰è®¾ç½®ä¸ºundefinedç¦ç”¨ï¼Œå¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰</span></span><br><span class="line">        {async_threshold_window, <span class="number">5</span>},        <span class="comment">% æ¡£æ—¥å¿—æ¶ˆæ¯å‡å°‘åˆ°ä¸€å®šæ•°é‡æ—¶åˆ‡æ¢åˆ°å¼‚æ­¥æ¨¡å¼ï¼Œæ¯”å¦‚è¿™é‡Œå°±æ˜¯20 - 5 = 15 å½“æ¶ˆæ¯å°‘äº15æ—¶åˆ‡å›å¼‚æ­¥ï¼Œ</span></span><br><span class="line">             								<span class="comment">% å¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰</span></span><br><span class="line"></span><br><span class="line">        {handlers, [</span><br><span class="line">            <span class="comment">%% lager_console_backend å¯è®¾ç½®å‚æ•°</span></span><br><span class="line">            <span class="comment">%% level æ—¥å¿—çº§åˆ«ï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% formatter æ ¼å¼åŒ–æ¨¡å—ï¼Œé»˜è®¤ï¼šlager_default_formatter</span></span><br><span class="line">            <span class="comment">%% formatter_config æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤ï¼š[time, " ", color, "[", severity,"] ", message]</span></span><br><span class="line">            <span class="comment">%% user_stderr æ˜¯å¦ä½¿ç”¨stderrï¼Œé»˜è®¤ï¼šfalse</span></span><br><span class="line">            <span class="comment">%% group_leader æŒ‡å®šè¦è¾“å‡ºçš„io_serverï¼Œé»˜è®¤ï¼šfalseï¼Œä½¿ç”¨userè¿›ç¨‹ä½œä¸ºio_server</span></span><br><span class="line">            {lager_console_backend, [</span><br><span class="line">                {level, debug},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]},</span><br><span class="line"></span><br><span class="line">            <span class="comment">%% lager_file_backend å¯è®¾ç½®å‚æ•°</span></span><br><span class="line">            <span class="comment">%% file æ—¥å¿—æ–‡ä»¶åï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% level æ—¥å¿—çº§åˆ« é»˜è®¤ï¼š&gt;=info</span></span><br><span class="line">            <span class="comment">%% size æ—¥å¿—æ–‡ä»¶å¤§å° é»˜è®¤ï¼š10MB</span></span><br><span class="line">            <span class="comment">%% date æ—¥å¿—åˆ‡å‰²æ—¶é—´ é»˜è®¤ï¼š$D0 æ¯æ—¥0ç‚¹</span></span><br><span class="line">            <span class="comment">%% count æ—¥å¿—åˆ‡åˆ†æ•°é‡ é»˜è®¤ï¼š5</span></span><br><span class="line">            <span class="comment">%% rotation æ—¥å¿—åˆ‡å‰²å¤„ç†æ¨¡å— é»˜è®¤ï¼šlager_rotator_default</span></span><br><span class="line">            <span class="comment">%% formatter æ ¼å¼åŒ–æ¨¡å— é»˜è®¤ï¼šlager_default_formatter</span></span><br><span class="line">            <span class="comment">%% formatter_config æ—¥å¿—æ ¼å¼ï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% sync_on ç«‹å³åŒæ­¥æ—¥å¿—çº§åˆ« é»˜è®¤ï¼šerror</span></span><br><span class="line">            <span class="comment">%% sync_interval æ—¥å¿—å†™æ–‡ä»¶é—´éš” é»˜è®¤ï¼š1000æ¯«ç§’</span></span><br><span class="line">            <span class="comment">%% sync_size æ—¥å¿—å†™æ–‡ä»¶å¤§å° é»˜è®¤ï¼š64KB</span></span><br><span class="line">            {lager_file_backend, [</span><br><span class="line">                {file, <span class="string">"error.log"</span>},</span><br><span class="line">                {level, '&gt;=error'},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]},</span><br><span class="line">            {lager_file_backend, [</span><br><span class="line">                {file, <span class="string">"info.log"</span>},</span><br><span class="line">                {level, '&lt;=warning'},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]}</span><br><span class="line">        ]},</span><br><span class="line"></span><br><span class="line">        <span class="comment">% {killer_hwm, 1000},               % é˜²æ´ªï¼Œå¦‚æœæ¶ˆæ¯é«˜æ°´ä½çº¿è¶…è¿‡æ­¤å€¼ï¼Œåˆ™åˆ æ‰ç›¸å…³æ¥æ”¶å™¨è¿›ç¨‹ï¼Œé»˜è®¤ï¼šundefined</span></span><br><span class="line">        <span class="comment">% {killer_reinstall_after, 5000}    % è¾¾åˆ°æ­¤æ—¶é—´åé‡å¯æ­¤æ¥æ”¶å™¨è¿›ç¨‹ï¼Œé»˜è®¤ï¼š5000æ¯«ç§’</span></span><br><span class="line">        {extra_sinks, [</span><br><span class="line">            {audit_lager_event, [</span><br><span class="line">                {handlers, [</span><br><span class="line">                    {lager_file_backend, [</span><br><span class="line">                        {file, <span class="string">"audit.log"</span>},</span><br><span class="line">                        {level, '=info'},</span><br><span class="line">                        {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">                    ]}ï¼Œ</span><br><span class="line">                <span class="comment">% {flush_queue, true}                 % åŠŸèƒ½ä¸ error_logger_flush_queue ä¸€æ ·ï¼Œå¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰ï¼Œé»˜è®¤ï¼štrue</span></span><br><span class="line">                <span class="comment">% {flush_threshold, 1000}             % åŠŸèƒ½ä¸ error_logger_flush_threshold ä¸€æ ·ï¼Œå¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰ï¼Œé»˜è®¤ï¼š0</span></span><br><span class="line">                               </span><br><span class="line">                {async_threshold, <span class="number">500</span>},			<span class="comment">% æµæ§ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å †ç§¯åˆ°500æ—¶ï¼Œæ—¥å¿—è°ƒç”¨ä¼šä»å¼‚æ­¥å˜ä¸ºåŒæ­¥</span></span><br><span class="line">                {async_threshold_window, <span class="number">50</span>}]   <span class="comment">% å½“æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦å°äº450ï¼ˆ500-50ï¼‰æ—¶ï¼Œä¼šåˆ‡æ¢å›å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">                ]}</span><br><span class="line">            ]}</span><br><span class="line">        ]}</span><br><span class="line">    ]}</span><br><span class="line">].</span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ—¥å¿—æ‰©å±•"><a href="#æ—¥å¿—æ‰©å±•" class="headerlink" title="æ—¥å¿—æ‰©å±•"></a>æ—¥å¿—æ‰©å±•</h4><p>Lager ç°åœ¨æ”¯æŒæ—¥å¿—æ‰©å±• <code>sink</code>ï¼Œæ¯ä¸ªæ¥æ”¶å™¨åä¸º <code>lager_event</code>ï¼ˆç”± <code>gen_event</code> ç®¡ç†å™¨å®ç°ï¼‰ï¼Œå¯ä»¥æœ‰ä¸åŒçš„åŒæ­¥ / å¼‚æ­¥æ¶ˆæ¯é˜ˆå€¼å’Œä¸åŒçš„åç«¯ã€‚</p>
<ul>
<li><p>æ‰©å±•é…ç½®</p>
<p>å®ç°æ—¥å¿—æ‰©å±•ï¼Œä½ éœ€è¦å¦‚ä¸‹æ“ä½œï¼š</p>
<ol>
<li>è®¾ç½® <code>rebar.config</code></li>
<li>åœ¨ <code>app.config</code> ä¸­é…ç½®åç«¯</li>
</ol>
</li>
<li><p>å‘½å</p>
<p>æ‰©å±•çš„æ¥æ”¶å™¨æœ‰ä¸¤ä¸ªåç§°ï¼š</p>
<p><em><strong>atom</strong></em>ï¼šç”¨ä½œå‘é€æ¶ˆæ¯çš„æ¨¡å—åï¼Œå¦‚ <code>audit</code></p>
<p><em><strong>atom_lager_event</strong></em>ï¼šç”¨äºåç«¯é…ç½®ï¼Œå¦‚ <code>audit_lager_event</code></p>
</li>
<li><p>rebar.config</p>
<p>åœ¨ <code>erl_opts</code> ä¸­åŒ…å«ä¸€ä¸ªæ¥æ”¶å™¨åç§°åˆ—è¡¨ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{lager_extra_sinks, [audit]}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>app.config</p>
<p>æ‰©å±• <code>lager</code> é…ç½®ï¼Œæ–°å¢é…ç½®é¡¹ <code>extra_sinks</code>ï¼Œæµæ§å’Œé˜²æ´ªæ˜¯å¯é€‰é¡¹ï¼Œåé¢ç« èŠ‚ä¼šæœ‰ä»‹ç»ã€‚</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[{lager, [</span><br><span class="line">          {log_root, <span class="string">"/tmp"</span>},</span><br><span class="line"></span><br><span class="line">          <span class="comment">%% Default handlers for lager/lager_event</span></span><br><span class="line">          {handlers, [</span><br><span class="line">                      {lager_console_backend, [{level, info}]},</span><br><span class="line">                      {lager_file_backend, [{file, <span class="string">"error.log"</span>}, {level, error}]},</span><br><span class="line">                      {lager_file_backend, [{file, <span class="string">"console.log"</span>}, {level, info}]}</span><br><span class="line">                     ]},</span><br><span class="line">          </span><br><span class="line">          {killer_hwm, <span class="number">1000</span>},				<span class="comment">% é˜²æ´ª</span></span><br><span class="line">		  {killer_reinstall_after, <span class="number">5000</span>},</span><br><span class="line">          <span class="comment">%% Any other sinks</span></span><br><span class="line">          {extra_sinks,</span><br><span class="line">           [</span><br><span class="line">            {audit_lager_event,</span><br><span class="line">             [{handlers,</span><br><span class="line">               [{lager_file_backend,</span><br><span class="line">                 [{file, <span class="string">"audit.log"</span>},</span><br><span class="line">                  {level, info}</span><br><span class="line">                 ]</span><br><span class="line">                }]</span><br><span class="line">              },</span><br><span class="line">              {async_threshold, <span class="number">500</span>},			<span class="comment">% æµæ§</span></span><br><span class="line">              {async_threshold_window, <span class="number">50</span>}]</span><br><span class="line">            }]</span><br><span class="line">          }</span><br><span class="line">         ]</span><br><span class="line"> }</span><br><span class="line">].</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>ä¸Šè¿°æ­¥éª¤å®Œæˆåï¼Œå°±å¯åƒè°ƒç”¨ <code>lager:info</code> ä¸€æ ·ä½¿ç”¨ <code>audit:info</code> ï¼Œä»–ä»¬çš„ä½¿ç”¨é€»è¾‘å’Œæ–¹æ³•å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯é€»è¾‘æ˜¯å®Œå…¨åˆ†å¼€çš„ï¼Œä¸ä¼šå› ä¸ºè¢«å¯¹æ–¹å½±å“ï¼Œè¿™åœ¨åšæ‰©å±•æ—¥å¿—çš„æ—¶å€™ä¼šéå¸¸æœ‰ç”¨ï¼Œä½ å¯ä»¥å°†æƒ³è¦é¢å¤–ç»Ÿè®¡çš„ã€ä¸å¤ªé‡è¦çš„æ•°æ®ä½¿ç”¨æ‰©å±•å¤„ç†æ¥åšï¼Œå³ä½¿æ‰©å±•æ—¥å¿—å¤ªå¤šï¼Œä¹Ÿä¸ä¼šå¯¹åŸç”Ÿæ—¥å¿—éƒ¨åˆ†æœ‰å½±å“ï¼Œè€Œä¸”å°†æ¥è¿›è¡Œæ—¥å¿—ä¸‹æ¶ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å»æ‰æ¥å—é¡¹ï¼Œä¸éœ€è¦å¯¹ä»£ç è¿›è¡Œæ›´æ”¹ã€‚ä¸Šè¿°ä¾‹å­çš„ <code>audit</code> æ˜¯å®Œå…¨è‡ªå®šä¹‰çš„åŸå­ï¼Œå¯ä»¥å®šä¹‰éœ€è¦çš„å­—æ®µï¼Œä½†æ˜¯éœ€è¦æ³¨æ„åç»­çš„ <code>lager_event</code> å‘½åä¸€å®šæ˜¯ <code>atom_lager_enent</code> ã€‚</p>
<ul>
<li><p>ä½¿ç”¨è‡ªå®šä¹‰ <code>sink</code></p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">-define</span><span class="params">(AUDIT(Args)</span>, audit:info<span class="params">(Args)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(AUDIT(Format, Args)</span>, audit:info<span class="params">(Format, Args)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(AUDIT(Attr, Format, Args)</span>, audit:info<span class="params">(Attr, Format, Args)</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">audit</span><span class="params">(Args)</span> -&gt;</span></span><br><span class="line">    ?AUDIT(Args).</span><br><span class="line"><span class="function"><span class="title">audit</span><span class="params">(Format, Args)</span> -&gt;</span></span><br><span class="line">    ?AUDIT(Format, Args).</span><br><span class="line"><span class="function"><span class="title">audit</span><span class="params">(Attr, Format, Args)</span> -&gt;</span></span><br><span class="line">    ?AUDIT(Attr, Format, Args).</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>æ‰©å±• <code>sink</code> æ‰“å°çš„æ—¥å¿—ä¸ä¼šæ˜¾ç¤ºåˆ°æ§åˆ¶å°ä¸Š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">%% audit_lager_event ä¸ºè‡ªå®šä¹‰sink</span></span><br><span class="line"><span class="comment">%% æ·»åŠ handler</span></span><br><span class="line"><span class="number">1</span>&gt; gen_event:add_handler(audit_lager_event, lager_console_backend, [{level, info}]).    </span><br><span class="line">ok</span><br><span class="line"><span class="comment">%% åˆ é™¤handler</span></span><br><span class="line"><span class="number">2</span>&gt; gen_event:delete_handler(audit_lager_event, lager_console_backend, [{level, info}]).</span><br><span class="line">ok</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="æ—¥å¿—æ ¼å¼åŒ–"><a href="#æ—¥å¿—æ ¼å¼åŒ–" class="headerlink" title="æ—¥å¿—æ ¼å¼åŒ–"></a>æ—¥å¿—æ ¼å¼åŒ–</h4><p>æ‰€æœ‰è®°å½•å™¨éƒ½æœ‰ä¸€ä¸ªå¯ä»¥é‡å†™çš„é»˜è®¤æ ¼å¼ï¼Œä½ åªéœ€è¦åœ¨æ ¼å¼åŒ–æ¨¡å—ä¸­å¯¼ <code>format(#lager_log_message{},Config#any())</code> å‡½æ•°å³å¯ï¼Œä¹‹ååŠ å…¥åˆ°æ¥æ”¶å™¨çš„é…ç½®ä¸­ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{lager, [</span><br><span class="line">  {handlers, [</span><br><span class="line">    {lager_console_backend, [{level, info}, {formatter, lager_default_formatter},</span><br><span class="line">      {formatter_config, [time,<span class="string">" ["</span>,severity,<span class="string">"] "</span>, message, <span class="string">"\n"</span>]}]},</span><br><span class="line">    {lager_file_backend, [{file, <span class="string">"error.log"</span>}, {level, error}, {formatter, lager_default_formatter},</span><br><span class="line">      {formatter_config, [date, <span class="string">" "</span>, time,<span class="string">" ["</span>,severity,<span class="string">"] "</span>,pid, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}]},</span><br><span class="line">    {lager_file_backend, [{file, <span class="string">"console.log"</span>}, {level, info}]}</span><br><span class="line">  ]}</span><br><span class="line">]}.</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šè¿°é…ç½®è¡¨ç¤ºæ—¥å¿—åœ¨ç”Ÿæˆåä¼šè°ƒç”¨ <code>lager_default_formatter:format(Message, [time," [",severity,"] ", message, â€œ\nâ€]}])</code> ã€‚</p>
<p>å…¶ä¸­ <code>formatter_config</code> ä¸­çš„åŸå­é¡¹ä¼šè¢« <code>forma</code> å‡½æ•°è¿›è¡Œæ›¿æ¢ï¼Œæ”¯æŒçš„åŸå­é¡¹å¦‚ä¸‹:</p>
<ul>
<li><p><em><strong>date</strong></em>, <em><strong>time</strong></em>, <em><strong>message</strong></em>, <em><strong>sev</strong></em> å’Œ <em><strong>severity</strong></em> æ˜¯å¸¸é©»é¡¹ï¼Œå…¶ä¸­<em><strong> sev</strong></em> æ˜¯ä»£è¡¨æ—¥å¿—ç­‰çº§çš„å•è¯ç¼©å†™ï¼Œå¦‚ â€˜debugâ€™ -&gt; $D</p>
</li>
<li><p><em><strong>pid</strong></em>, <em><strong>file</strong></em>, <em><strong>line</strong></em>, <em><strong>module</strong></em>, <em><strong>function</strong></em> å’Œ <em><strong>node</strong></em> åœ¨æœ‰ <code>parse_transform</code> ç¼–è¯‘é€‰é¡¹ä¸‹ä¹Ÿæ˜¯å¸¸é©»é¡¹</p>
</li>
<li><p><em><strong>application</strong></em> åœ¨ <code>parse_transform</code> ç¼–è¯‘é€‰é¡¹ä¸‹å¯èƒ½æœ‰å€¼ï¼Œè¿™å–å†³äºæºæ–‡ä»¶ç›®å½•ä¸‹æ˜¯å¦æœ‰ <code>app.src</code> æ–‡ä»¶</p>
</li>
<li><p>åº”ç”¨ç¨‹åºå¯ä»¥å®šä¹‰è‡ªå·±çš„å…ƒæ•°æ®å ä½ç¬¦ï¼Œå¦‚ <code>{atom(), semi-iolist()}</code> ã€ <code>{atom(), semi-iolist(), semi-iolist()}</code> ã€ <code>{pterm, atom()}</code> ã€ </p>
<p><code>{pterm, atom(), semi-iolist()}</code> ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="string">"Foo"</span>] -&gt; <span class="string">"Foo"</span>, regardless <span class="keyword">of</span> message content.</span><br><span class="line">[message] -&gt; The content <span class="keyword">of</span> the logged message, alone.</span><br><span class="line">[{pid,<span class="string">"Unknown Pid"</span>}] -&gt; <span class="string">"&lt;?.?.?&gt;"</span> <span class="keyword">if</span> pid is in the metadata, <span class="string">"Unknown Pid"</span> <span class="keyword">if</span> <span class="keyword">not</span>.</span><br><span class="line">[{pid, [<span class="string">"My pid is "</span>, pid], [<span class="string">"Unknown Pid"</span>]}] -&gt; <span class="keyword">if</span> pid is in the metadata print <span class="string">"My pid is &lt;?.?.?&gt;"</span>, otherwise print <span class="string">"Unknown Pid"</span></span><br><span class="line">[{server,{pid, [<span class="string">"("</span>, pid, <span class="string">")"</span>], [<span class="string">"(Unknown Server)"</span>]}}] -&gt; user provided server metadata, otherwise <span class="string">"(&lt;?.?.?&gt;)"</span>, otherwise <span class="string">"(Unknown Server)"</span></span><br><span class="line">[{pterm, pterm_key, &lt;&lt;<span class="string">"undefined"</span>&gt;&gt;}] -&gt; <span class="keyword">if</span> a value for 'pterm_key' is found in OTP <span class="number">21</span> (or later) persistent_term storage it is used, otherwise <span class="string">"undefined"</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLager ä½¿ç”¨æœ¬åœ°æ—¶é—´æ¥ä½œä¸ºæ—¥å¿—ç”Ÿæˆçš„æ—¶é—´ï¼Œå¦‚æœæƒ³ä½¿ç”¨ utc æ—¶é—´æ¥è®°å½•æ—¥å¿—ï¼Œé‚£ä¹ˆåœ¨ <code>app.config</code> ä¸­åŠ å…¥ã€‚</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">%% format log timestamps as UTC</span></span><br><span class="line">[{sasl, [{utc_log, true}]}].</span><br></pre></td></tr></tbody></table></figure>



<h4 id="è¿‡è½½ä¿æŠ¤"><a href="#è¿‡è½½ä¿æŠ¤" class="headerlink" title="è¿‡è½½ä¿æŠ¤"></a>è¿‡è½½ä¿æŠ¤</h4><h5 id="å¼‚æ­¥æ¨¡å¼"><a href="#å¼‚æ­¥æ¨¡å¼" class="headerlink" title="å¼‚æ­¥æ¨¡å¼"></a>å¼‚æ­¥æ¨¡å¼</h5><p>åœ¨ Lager2.0 åï¼Œæ”¯æŒåŒæ­¥æ—¥å¿—è°ƒç”¨ï¼Œä¹‹å‰åªæœ‰å¼‚æ­¥æ—¥å¿—è°ƒç”¨ï¼Œè™½ç„¶å¼‚æ­¥è°ƒç”¨ä¼šå¸¦æ¥æ•ˆç‡ä¸Šçš„æ”¶ç›Šï¼Œä½†æ˜¯æ— æ³•é˜²æ­¢æ¶ˆæ¯é˜Ÿåˆ—è¿‡è½½ï¼Œç°åœ¨é€šè¿‡è½®è¯¢æ¶ˆæ¯é‚®ç®±å¤§å°ï¼Œå¹¶æ ¹æ®é‚®ç®±å¤§å°åœ¨åŒæ­¥å’Œå¼‚æ­¥ä¹‹é—´åˆ‡æ¢æ¶ˆæ¯ä¼ é€’æ¨¡å¼ã€‚</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{ async_thresholdï¼Œ<span class="number">20</span> }ï¼Œ</span><br><span class="line">{ async_threshold_windowï¼Œ<span class="number">5</span> }</span><br></pre></td></tr></tbody></table></figure>


<p>è¿™è¡¨ç¤ºåœ¨æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯åˆ° 20 æ—¶ï¼Œæ—¥å¿—è°ƒç”¨ä¼šä»å¼‚æ­¥å˜ä¸ºåŒæ­¥ï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦å°äº 15ï¼ˆ20-15ï¼‰æ—¶ï¼Œä¼šåˆ‡æ¢å›å¼‚æ­¥è°ƒç”¨ã€‚</p>
<p>è¿™è¡¨ç¤ºåœ¨æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯åˆ° 20 æ—¶ï¼Œæ—¥å¿—è°ƒç”¨ä¼šä»å¼‚æ­¥å˜ä¸ºåŒæ­¥ï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦å°äº 15ï¼ˆ20-15ï¼‰æ—¶ï¼Œä¼šåˆ‡æ¢å›å¼‚æ­¥è°ƒç”¨</p>
<p>å¦‚æœä½ æ‹…å¿ƒæ—¥å¿—ä¼šé˜»å¡é€»è¾‘è¡Œä¸ºï¼Œå¯ä»¥é€šè¿‡é…ç½®å…³é—­ï¼Œåªéœ€è®¾ç½® <code>async_threshold</code> ä¸º <code>undefined</code>ã€‚å…¶é»˜è®¤å€¼ä¹Ÿæ˜¯ä¸ªè¾ƒå°çš„å€¼ï¼Œç›®çš„ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢æ—¥å¿—è¿‡æµï¼Œå› ä¸º Lager å¯¹æ—¥å¿—éƒ½æ˜¯å°½å¿«çš„å¤„ç†ï¼Œå¦‚æœæ—¥å¿—ä¼šå †ç§¯ï¼Œè¯´æ˜ç³»ç»Ÿè¿˜æ˜¯æœ‰å¼‚å¸¸ï¼Œåº”è¯¥ç€æ‰‹äºè§£å†³ç³»ç»Ÿçš„å¼‚å¸¸ï¼Œè€Œä¸æ˜¯è®©æ—¥å¿—åŠŸèƒ½å»å…¼å®¹ã€‚</p>
<p>åŒæ ·å¦‚æœæƒ³é™åˆ¶ error_logger çš„æ¶ˆæ¯æ•°ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{error_logger_hwmï¼Œ<span class="number">50</span> }</span><br></pre></td></tr></tbody></table></figure>


<p>æœ€å¥½ç¡®ä¿è¿™ä¸ªæ•°å­—è¾ƒå°ã€‚</p>
<h5 id="äº‹ä»¶é˜Ÿåˆ—æ¸…ç†"><a href="#äº‹ä»¶é˜Ÿåˆ—æ¸…ç†" class="headerlink" title="äº‹ä»¶é˜Ÿåˆ—æ¸…ç†"></a>äº‹ä»¶é˜Ÿåˆ—æ¸…ç†</h5><p>æ¶ˆæ¯é˜Ÿåˆ—æ¸…ç†ç”± <code>high_water_mark</code> å’Œ <code>flush_queue</code> æ§åˆ¶ï¼ŒäºŒè€…å‡è¾¾åˆ°åæ‰ä¼šè§¦å‘æ¸…ç†é€»è¾‘ã€‚</p>
<ul>
<li>high_water_mark ï¼šé«˜æ°´ä½è®¾å®šï¼Œæ°´ä½æŒ‡æ¯ç§’æ”¶åˆ°çš„ä¿¡æ¯</li>
<li> flush_queue ï¼š é˜Ÿåˆ—æ¸…ç†</li>
</ul>
<p><code>error_logger</code> é«˜æ°´ä½é»˜è®¤å€¼æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯åªè¦æ¶ˆæ¯å †ç§¯å°±ä¼šè§¦å‘æ¸…ç†é€»è¾‘ï¼Œä½†æ˜¯å…¶ä»–æ¥æ”¶å™¨åœ¨ä¸é…ç½®é«˜æ°´ä½æ•°å€¼çš„æ—¶å€™ï¼Œé»˜è®¤å€¼æ˜¯ undefinedï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå¯ç”¨æ¸…ç†é€»è¾‘ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨éœ€è¦åœ¨é…ç½®ä¸­åŠ å…¥</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{error_logger_hwm, <span class="number">50</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯ä»¥é€šè¿‡è®¾å®šé«˜æ°´ä½è®©æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ä¸¢å¼ƒæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸¢å¼ƒæ¶ˆæ¯å¯èƒ½ä¼šå½±å“æ—¥å¿—ä¸Šä¸‹æ–‡ï¼Œé«˜æ°´ä½é˜Ÿåˆ—æ¸…ç†åŠŸèƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¹ <code>error_logger</code> è¿›è¡Œæ§åˆ¶ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{error_logger_flush_queue, true | false}</span><br></pre></td></tr></tbody></table></figure>


<p>å…¶ä»–æ¥æ”¶å™¨ï¼ŒåŠ å…¥åˆ°æŒ‡å®š <code>sink</code> çš„é…ç½®ä¸­</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{flush_queue, true | false}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœ <code>flush_queue</code> ä¸º<em><strong> true</strong></em>ï¼Œåˆ™å¯ä»¥è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦é˜ˆå€¼ï¼Œåœ¨è¯¥é˜ˆå€¼å¤„æ¶ˆæ¯å°†å¼€å§‹è¢«ä¸¢å¼ƒã€‚<code>error_logger</code> é»˜è®¤å€¼æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯åªè¦æ¶ˆæ¯å †ç§¯å°±ä¼šè§¦å‘æ¸…ç†é€»è¾‘è¢«ä¸¢å¼ƒã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¹ <code>error_logger</code> çš„é˜ˆå€¼è¿›è¡Œæ§åˆ¶ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{error_logger_flush_threshold, <span class="number">1000</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>å¯¹äºå…¶ä»–æ¥å—å™¨ï¼Œé»˜è®¤ä¹Ÿæ˜¯ 0ï¼Œå¯ä»¥é€šè¿‡å•ç‹¬çš„é…ç½®ä¿®æ”¹</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{flush_threshold, <span class="number">1000</span>}</span><br></pre></td></tr></tbody></table></figure>


<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¢å¼ƒæ¶ˆæ¯æ°¸è¿œæ˜¯åœ¨è§¦å‘äº†é«˜æ°´ä½è®¾å®šçš„æƒ…å†µä¸‹æ‰èƒ½è§¦å‘ï¼Œä¹Ÿå°±æ˜¯æ°´ä½å¦‚æœé«˜äº†ï¼Œä¸¢å¼ƒæ¶ˆæ¯çš„é€»è¾‘å¹¶ä¸ä¼šè§¦å‘ï¼Œæ°´ä½å¦‚æœä½ï¼Œä½†æ˜¯ä¸¢å¼ƒæ¶ˆæ¯çš„é˜ˆå€¼è®¾å®šçš„é«˜ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<h5 id="æ¥æ”¶å™¨æ€æ‰‹"><a href="#æ¥æ”¶å™¨æ€æ‰‹" class="headerlink" title="æ¥æ”¶å™¨æ€æ‰‹"></a>æ¥æ”¶å™¨æ€æ‰‹</h5><p>å¯¹äºè‡ªå®šä¹‰çš„æ¥æ”¶å™¨ï¼Œæœ‰æ—¶å€™åœ¨æ¶ˆæ¯å †ç§¯çš„æ—¶å€™ï¼Œç›´æ¥æ€æ‰æ¥æ”¶é€»è¾‘è¿›ç¨‹å¹¶é‡å¯ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{killer_hwm, <span class="number">1000</span>},</span><br><span class="line">{killer_reinstall_after, <span class="number">5000</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ„å‘³ç€ï¼Œå¦‚æœæ¥æ”¶å™¨çš„è¶…è¿‡ 1000 æ¡æ¶ˆæ¯å †ç§¯ï¼Œå°†æ€æ­»æ•´ä¸ªæ¥æ”¶å™¨å¹¶åœ¨ 5000 æ¯«ç§’åé‡æ–°åŠ è½½å®ƒã€‚</p>
<p>é»˜è®¤æ˜¯ä¸ä¼šè®¾ç½®è‡ªæ€æ°´ä½ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå¯ç”¨è‡ªæ€åŠŸèƒ½ï¼Œè€Œé‡å¯çš„é»˜è®¤æ—¶é—´æ˜¯ 5000msã€‚</p>
<h4 id="æ—¥å¿—ç­‰çº§è®¾å®š"><a href="#æ—¥å¿—ç­‰çº§è®¾å®š" class="headerlink" title="æ—¥å¿—ç­‰çº§è®¾å®š"></a>æ—¥å¿—ç­‰çº§è®¾å®š</h4><p>ä»ä½åˆ°é«˜åˆ†åˆ«ä¸ºï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">debug &lt; info &lt; notice &lt; warning &lt; error &lt; critical &lt; alter &lt; emergency</span><br></pre></td></tr></tbody></table></figure>

<p>Lager æ”¯æŒç±»ä¼¼ <code>syslog</code> å½¢å¼å®šä¹‰çº§åˆ«ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">info        % infoåŠæ›´é«˜çº§åˆ«ï¼ˆ&gt;=info éšå¼ï¼‰</span><br><span class="line">=debug      % åªæœ‰debugçº§åˆ«</span><br><span class="line">!=info      % é™¤äº†infoçº§åˆ«ä»¥å¤–çš„æ‰€æœ‰çº§åˆ«</span><br><span class="line">&lt;=notice    % noticeåŠæ›´ä½çº§åˆ«</span><br><span class="line">&lt;warning    % ä»»ä½•å°äºwarningçš„çº§åˆ«</span><br></pre></td></tr></tbody></table></figure>



<h4 id="è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹"><a href="#è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹" class="headerlink" title="è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹"></a>è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹</h4><ul>
<li><p>æŸ¥çœ‹æ—¥å¿—çº§åˆ«</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">lager:get_loglevel(lager_console_backend).</span><br><span class="line">lager:get_loglevel({lager_file_backend,<span class="string">"info.log"</span>}).</span><br><span class="line">lager:get_loglevel({lager_file_backend,<span class="string">"error.log"</span>}).</span><br><span class="line">lager:get_loglevel(sink_lager_event, {lager_file_backend,<span class="string">"sink.log"</span>}).</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>è®¾ç½®æ—¥å¿—çº§åˆ«</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">lager:set_loglevel(lager_console_backend,'info'). </span><br><span class="line">lager:set_loglevel({lager_file_backend, <span class="string">"info.log"</span>},'debug').                          </span><br><span class="line">lager:set_loglevel(sink_lager_event, {lager_file_backend, <span class="string">"sink.log"</span>}, undefined, 'info').</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="æ—¥å¿—æ–‡ä»¶è½®è½¬"><a href="#æ—¥å¿—æ–‡ä»¶è½®è½¬" class="headerlink" title="æ—¥å¿—æ–‡ä»¶è½®è½¬"></a>æ—¥å¿—æ–‡ä»¶è½®è½¬</h4><p>Lager è‡ªå·±å¯ä»¥å®Œæˆæ—¥å¿—æ–‡ä»¶çš„è½®è½¬ï¼Œæˆ–è€…ç”±å¤–éƒ¨è¿›ç¨‹è´Ÿè´£ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œä½¿ç”¨å…³é”®å˜é‡<em><strong> date</strong></em>ã€<em><strong>size</strong></em>ã€<em><strong>count</strong></em> æ·»åŠ åœ¨ <code>backend</code> çš„é…ç½®ä¸­å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[{file, <span class="string">"error.log"</span>}, {level, error}, {size, <span class="number">10485760</span>}, {date, <span class="string">"$D0"</span>}, {count, <span class="number">5</span>}]</span><br></pre></td></tr></tbody></table></figure>


<p>è¿™å‘Šè¯‰ Lager å°†é”™è¯¯å’Œä»¥ä¸Šæ¶ˆæ¯è®°å½•åˆ° <code>error.log</code> æ–‡ä»¶ï¼Œå¹¶åœ¨åˆå¤œæˆ–åˆ°è¾¾ 10mb æ—¶æ—‹è½¬æ–‡ä»¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œå¹¶åœ¨å½“å‰æ–‡ä»¶ä¹‹å¤–å†ä¿ç•™ 5 ä¸ªæ—‹è½¬çš„æ—¥å¿—ã€‚å°†<em><strong> count</strong></em> è®¾ç½®ä¸º 0 ä¸ä¼šç¦ç”¨æ—‹è½¬ï¼Œè€Œæ˜¯æ—‹è½¬æ–‡ä»¶å¹¶ä¸”ä¸ä¿ç•™ä»¥å‰çš„ç‰ˆæœ¬ã€‚è¦ç¦ç”¨æ—‹è½¬ï¼Œå°†å¤§å°è®¾ç½®ä¸º 0ï¼Œå°†æ—¥æœŸè®¾ç½®ä¸ºâ€â€ã€‚</p>
<p>è¿™å‘Šè¯‰ Lager å°†é”™è¯¯å’Œä»¥ä¸Šæ¶ˆæ¯è®°å½•åˆ° <code>error.log</code> æ–‡ä»¶ï¼Œå¹¶åœ¨åˆå¤œæˆ–åˆ°è¾¾ 10mb æ—¶æ—‹è½¬æ–‡ä»¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œå¹¶åœ¨å½“å‰æ–‡ä»¶ä¹‹å¤–å†ä¿ç•™ 5 ä¸ªæ—‹è½¬çš„æ—¥å¿—ã€‚å°†<em><strong> count</strong></em> è®¾ç½®ä¸º 0 ä¸ä¼šç¦ç”¨æ—‹è½¬ï¼Œè€Œæ˜¯æ—‹è½¬æ–‡ä»¶å¹¶ä¸”ä¸ä¿ç•™ä»¥å‰çš„ç‰ˆæœ¬ã€‚è¦ç¦ç”¨æ—‹è½¬ï¼Œå°†å¤§å°è®¾ç½®ä¸º 0ï¼Œå°†æ—¥æœŸè®¾ç½®ä¸ºâ€â€ã€‚</p>
<p>è¯¥ $D0 è¯­æ³•æ¥è‡ª <code>newsyslog.conf </code>ä¸­ <code>newsyslog </code>ä½¿ç”¨çš„è¯­æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">Day, week and month time format: The lead-in character</span><br><span class="line">for day, week and month specification is a `$'-sign.</span><br><span class="line">The particular format of day, week and month</span><br><span class="line">specification is: [Dhh], [Ww[Dhh]] and [Mdd[Dhh]],</span><br><span class="line">respectively.  Optional time fields default to</span><br><span class="line">midnight.  The ranges for day and hour specifications</span><br><span class="line">are:</span><br><span class="line">  mm      minutes, range 0 ... 59</span><br><span class="line">  hh      hours, range 0 ... 23</span><br><span class="line">  w       day of week, range 0 ... 6, 0 = Sunday</span><br><span class="line">  dd      day of month, range 1 ... 31, or the</span><br><span class="line">          letter L or l to specify the last day of</span><br><span class="line">          the month.</span><br><span class="line"></span><br><span class="line">Some examples:</span><br><span class="line">  $H00    rotate every hour at HH:00</span><br><span class="line">  $D0     rotate every night at midnight</span><br><span class="line">  $D23    rotate every day at 23:00 hr</span><br><span class="line">  $D12H30 rotate every day at 12:30</span><br><span class="line">  $W0D23  rotate every week on Sunday at 23:00 hr</span><br><span class="line">  $W5D16  rotate every week on Friday at 16:00 hr</span><br><span class="line">  $W0D0H0 rotate every week on Sunday at 00:00</span><br><span class="line">  $M1D0   rotate on the first day of every month at</span><br><span class="line">          midnight (i.e., the start of the day)</span><br><span class="line">  $M5D6   rotate on every 5th day of the month at</span><br><span class="line">          6:00 hr</span><br></pre></td></tr></tbody></table></figure>



<h4 id="å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨"><a href="#å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨" class="headerlink" title="å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨"></a>å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨</h4><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®é¡¹å®šä¹‰ <code>lager_file_backend</code> è‡ªå®šä¹‰æ—¥å¿—å¾ªç¯å™¨</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{rotator, lager_rotator_default}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¨¡å—åº”è¯¥æ˜¯ä¸€ä¸ª <code>lager_rotator_behaviour</code>, ä¹Ÿå°±æ˜¯åº”æä¾›ä»¥ä¸‹å›è°ƒï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">%% @doc Create a log file</span></span><br><span class="line">-callback<span class="params">(create_logfile(Name::list(), Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Open a log file</span></span><br><span class="line">-callback<span class="params">(open_logfile(Name::list(), Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Ensure reference to current target, could be rotated</span></span><br><span class="line">-callback<span class="params">(ensure_logfile(Name::list(), FD::file:io_device(), Inode::integer(),</span></span><br><span class="line"><span class="params">                         Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Rotate the log file</span></span><br><span class="line">-callback<span class="params">(rotate_logfile(Name::list(), Count::integer()) -&gt;</span></span><br><span class="line"><span class="params">    ok)</span>.</span><br></pre></td></tr></tbody></table></figure>



<h4 id="æ‰“å°å¼‚å¸¸-exception"><a href="#æ‰“å°å¼‚å¸¸-exception" class="headerlink" title="æ‰“å°å¼‚å¸¸ - exception"></a>æ‰“å°å¼‚å¸¸ - exception</h4><p>OTP 21+</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">    foo()</span><br><span class="line"><span class="keyword">catch</span></span><br><span class="line">    Class:Reason:Stacktrace -&gt;</span><br><span class="line">        lager:error(</span><br><span class="line">            <span class="string">"~nStacktrace:~s"</span>,</span><br><span class="line">            [lager:pr_stacktrace(Stacktrace, {Class, Reason})])</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></tbody></table></figure>



<h4 id="æ‰“å°è®°å½•-record"><a href="#æ‰“å°è®°å½•-record" class="headerlink" title="æ‰“å°è®°å½• - record"></a>æ‰“å°è®°å½• - record</h4><figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>&gt; lager:info(<span class="string">"My state is ~p"</span>, [lager:pr(State, ?MODULE)]).</span><br><span class="line">My state is #state{}</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>&gt; lager:info(<span class="string">"My state is ~p"</span>,[State]).</span><br><span class="line">My state is {state}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º"><a href="#å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º" class="headerlink" title="å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º"></a>å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º</h4><p>åœ¨ <code>app.config</code> ä¸­ Lager é…ç½®é¡¹ä¸­å¯ç”¨</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{colored, true}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä¸å–œæ¬¢é»˜è®¤çš„é¢œè‰²ï¼Œå¯ä»¥åœ¨ <code>lager.app.src</code> ä¸­æ›´æ”¹ã€‚</p>
<p>ç€è‰²æ˜¯ä»<em><strong> color</strong></em> åŸå­å‡ºç°åçš„ä½ç½®å¼€å§‹åˆ°æ¶ˆæ¯ç»“æŸï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{lager_console_backend, [{level, info}, {formatter, lager_default_formatter},</span><br><span class="line">  {formatter_config, [time, color, <span class="string">" ["</span>,severity,<span class="string">"] "</span>, message, <span class="string">"\e[0m\r\n"</span>]}]]}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­å°†æŸ“è‰²æ¶ˆæ¯ä¸­çš„æ‰€æœ‰å­—æ®µï¼Œé™¤äº† <em><strong>time</strong></em> ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ windows æ˜¯ä¸æ”¯æŒå‘½ä»¤è¡ŒæŸ“è‰²çš„ï¼Œæ— è®ºä»€ä¹ˆç‰ˆæœ¬ã€‚</p>
<h4 id="åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶"><a href="#åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶" class="headerlink" title="åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶"></a>åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶</h4><p>Lager é»˜è®¤å°†æ¶ˆæ¯æˆªæ–­ä¸º 4096 å­—èŠ‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥ <code>{lager_truncation_size, X}</code> é€‰é¡¹è¿›è¡Œæ›´æ”¹ï¼Œå¯ä»¥åŠ å…¥åˆ° <code>rebar</code> ä¸­çš„ <code>erl_opts</code> å­—æ®µï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{erl_opts, [{parse_transform, lager_transform}, {lager_truncation_size, <span class="number">1024</span>}]}.</span><br></pre></td></tr></tbody></table></figure>



<h4 id="ç¦æ­¢applications-å’Œ-supervisorså¯åŠ¨-åœæ­¢æ—¥å¿—"><a href="#ç¦æ­¢applications-å’Œ-supervisorså¯åŠ¨-åœæ­¢æ—¥å¿—" class="headerlink" title="ç¦æ­¢applications å’Œ supervisorså¯åŠ¨/åœæ­¢æ—¥å¿—"></a>ç¦æ­¢ applications å’Œ supervisors å¯åŠ¨ / åœæ­¢æ—¥å¿—</h4><p>å¦‚æœä½ ä¸æƒ³çœ‹åˆ°åº”ç”¨çš„å¯åŠ¨å’Œå…³é—­æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®è¿›è¡Œå…³é—­ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{lager, [{suppress_application_start_stop, true},</span><br><span class="line">         {suppress_supervisor_start_stop, true}]}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode"><a href="#æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode" class="headerlink" title="æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode"></a>æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ª Node</h4><p>å¦‚æœä½ æƒ³æŠŠä½ çš„æ§åˆ¶å°è¾“å‡ºå‘é€åˆ°å¦ä¸€ä¸ª <code>group_leader</code> (é€šå¸¸æ˜¯åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Š)ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ª <code>{group_leader, Pid}</code> å‚æ•°åˆ°æ§åˆ¶å°åç«¯ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">GL = erlang:group_leader(),</span><br><span class="line">  Node = node(GL),</span><br><span class="line">  lager_app:start_handler(lager_event, {lager_console_backend, Node},</span><br><span class="line">       [{group_leader, GL}, {level, none}, {id, {lager_console_backend, Node}}]),</span><br><span class="line">  <span class="keyword">case</span> lager:trace({lager_console_backend, Node}, Filter, Level) <span class="keyword">of</span></span><br><span class="line">       ...</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‡å®šä»£ç æ˜¯é€šè¿‡ <code>nodetool rpc</code> è°ƒç”¨è¿è¡Œçš„ã€‚ä»£ç åœ¨ Erlang èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œä½† <code>group_leader</code> åœ¨ <code>reltool</code> èŠ‚ç‚¹ä¸Šï¼Œä¾‹å¦‚ <code>appname_maint_12345@127.0.0.1</code>ã€‚å¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨è·Ÿè¸ªè¿™ä¸ªç‰¹æ€§ï¼Œè¯·ç¡®ä¿ <code>lager_app:start_handler</code> çš„ç¬¬äºŒä¸ªå‚æ•°å’Œ <code>id</code> å‚æ•°åŒ¹é…ã€‚å½“è‡ªå®šä¹‰ <code>group_leader</code> è¿›ç¨‹é€€å‡ºæ—¶ï¼ŒLager å°†åˆ é™¤è¯¥å¤„ç†ç¨‹åºçš„ä»»ä½•ç›¸å…³è·Ÿè¸ªã€‚</p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://github.com/erlang-lager/lager">Lager.git</a></p>
<p><a href="https://blog.csdn.net/eeeggghit/article/details/103349224?utm_medium=distribute.pc_relevant.none-task-blog-title-3&amp;spm=1001.2101.3001.4242">Lager åº“ä½¿ç”¨ä»‹ç»</a></p>
]]></content>
      <tags>
        <tag>erlang</tag>
        <tag>log</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›è¯</title>
    <url>/2021/04/15/%E9%82%A3%E4%BA%9B%E8%AF%9D/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å‡­ä»€ä¹ˆæŒ¡åœ¨æœ€å‰é¢ï¼Ÿ</p>
<p>å‹‡æ°”ã€å¿ è¯šã€ä½“é­„ã€å­¦è¯†</p>
]]></content>
      <tags>
        <tag>essay</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›æ­Œ</title>
    <url>/2021/04/15/%E9%82%A3%E4%BA%9B%E6%AD%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h5 id="x1f442-ç½‘æ˜“äº‘"><a href="#x1f442-ç½‘æ˜“äº‘" class="headerlink" title="ğŸ‘‚ç½‘æ˜“äº‘"></a><span class="github-emoji" alias="ear" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f442.png?v8">ğŸ‘‚</span>ç½‘æ˜“äº‘</h5>
    <div id="aplayer-zuCPvsRZ" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="6647556685" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"></div>

]]></content>
      <tags>
        <tag>essay</tag>
      </tags>
  </entry>
</search>
