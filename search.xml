<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>todo</title>
    <url>/2021/04/15/todo/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Todoâ€¦</p>
<span id="more"></span>

<h4 id="Erlang"><a href="#Erlang" class="headerlink" title="Erlang"></a>Erlang</h4><p>gc</p>
<p>rika</p>
<p>hot_reload</p>
<p>cluster</p>
<p>node</p>
<p>io:user</p>
<p>binary</p>
<h4 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h4><h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p>ä¸»ä»</p>
<h4 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h4><p>tcp</p>
<p>udp</p>
<p>http</p>
<p>mqtt</p>
<p>coap</p>
]]></content>
  </entry>
  <entry>
    <title>rebar</title>
    <url>/2021/04/15/rebar/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script>]]></content>
  </entry>
  <entry>
    <title>lager</title>
    <url>/2021/04/15/lager/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>lager æ˜¯ erlang å’Œ exlir çš„ä¸€ä¸ªæ—¥å¿—åº“ã€‚</p>
<h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ul>
<li><p>ç»†ç²’åº¦æ—¥å¿—çº§åˆ«ï¼ˆdebug, info, notice, warning, error, critical, alert, emergencyï¼‰</p>
</li>
<li><p>è®°å½•å™¨ä½¿ç”¨ parse transform è¿›è¡Œè½¬æ¢ï¼Œä»¥å…è®¸æ•è· Module/Function/Line/Pid ä¿¡æ¯</p>
</li>
<li><p>å½“æ²¡æœ‰å¤„ç†ç¨‹åºæ­£åœ¨ä½¿ç”¨æ—¥å¿—çº§åˆ«æ—¶ (ä¾‹å¦‚ debug)ï¼Œæ²¡æœ‰äº‹ä»¶è¢«å‘é€åˆ°æ—¥å¿—å¤„ç†å™¨</p>
</li>
<li><p>æ”¯æŒå¤šä¸ªåç«¯ï¼ŒåŒ…æ‹¬æ§åˆ¶å°å’Œæ–‡ä»¶</p>
</li>
<li><p>æ”¯æŒå¤šä¸ª sink æ‰©å±•</p>
  <span id="more"></span></li>
<li><p>å°†å¸¸è§çš„ OTP é”™è¯¯æ¶ˆæ¯æ”¹å†™ä¸ºæ›´æ˜“è¯»çš„æ¶ˆæ¯</p>
</li>
<li><p>æ”¯æŒåœ¨ç¼–è¯‘æ—¶å¤„ç†è®°å½•ï¼Œå¹¶å¯å®Œæ•´è¾“å‡º</p>
</li>
<li><p>åœ¨é¢å¯¹è¾ƒå¤§æˆ–è¾ƒå¤šçš„æ—¥å¿—æ¶ˆæ¯æ—¶ï¼Œä¸ä¼šå‡ºç°èŠ‚ç‚¹å†…å­˜ä¸è¶³çš„æƒ…å†µ</p>
</li>
<li><p>ç»•è¿‡æ—¥å¿—å¤§å°æˆªæ–­çš„å¯é€‰ç‰¹æ€§ (â€œä¸å®‰å…¨â€)</p>
</li>
<li><p>æ”¯æŒå†…éƒ¨æ—¶é—´å’Œæ—¥æœŸæ—‹è½¬ï¼Œä»¥åŠå¤–éƒ¨æ—‹è½¬å·¥å…·</p>
</li>
<li><p>syslog ç±»å‹çš„æ—¥å¿—æ ‡ç­¾</p>
</li>
<li><p>å½©è‰²çš„ç»ˆç«¯è¾“å‡º</p>
</li>
<li><p>æ”¯æŒ map</p>
</li>
<li><p>å¯é€‰çš„è´Ÿè½½å‰Šå‡è®¾ç½®é«˜æ°´ä½çº¿ï¼Œæ€æ­» (å¹¶é‡æ–°å¯åŠ¨) ä¸€ä¸ª sink åï¼Œå¯é…ç½®å†·å´å®šæ—¶å™¨</p>
</li>
</ul>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>rebar.config</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{erl_opts,[</span><br><span class="line">    ...</span><br><span class="line">    {parse_transform, lager_transform},     </span><br><span class="line">    {lager_truncation_size, <span class="number">1024</span>},          <span class="comment">% é™åˆ¶å•æ¡æ—¥å¿—æœ€å¤§å°ºå¯¸</span></span><br><span class="line">    {lager_extra_sinks, [msg]},             <span class="comment">% æ‰©å±•æ—¥å¿—</span></span><br><span class="line">    ...</span><br><span class="line">]}.</span><br><span class="line"></span><br><span class="line">{deps,[</span><br><span class="line">       {lager, <span class="string">"3.9.1"</span>}</span><br><span class="line">      ]}</span><br></pre></td></tr></tbody></table></figure>

<p>sys.config</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    {lager_test, []},</span><br><span class="line">    {lager, [</span><br><span class="line"></span><br><span class="line">        {log_root, <span class="string">"./log"</span>},                <span class="comment">% æ—¥å¿—æ ¹ç›®å½•</span></span><br><span class="line"></span><br><span class="line">        {crash_log, <span class="string">"crash.log"</span>},           <span class="comment">% è®¾ç½®åå½“ç³»ç»Ÿå‘ç”Ÿä¸¥é‡å´©æºƒæ—¶ï¼Œä¼šå°†æ—¥å¿—è®°å½•åœ¨æ­¤æ–‡ä»¶ä¸­</span></span><br><span class="line">        {crash_log_msg_size, <span class="number">65536</span>},        <span class="comment">% å´©æºƒæ—¥å¿—çš„æ¶ˆæ¯å¤§å°çš„é™åˆ¶</span></span><br><span class="line">        {crash_log_size, <span class="number">10485760</span>},         <span class="comment">% å´©æºƒæ—¥å¿—çš„æ–‡ä»¶å¤§å°é™åˆ¶</span></span><br><span class="line">        {crash_log_data, <span class="string">"$D0"</span>},            <span class="comment">% å´©æºƒæ—¥å¿—çš„åˆ‡å‰²æ—¶é—´</span></span><br><span class="line">        {crash_log_count, <span class="number">5</span>},               <span class="comment">% å´©æºƒæ—¥å¿—çš„åˆ‡å‰²æ•°é‡</span></span><br><span class="line"></span><br><span class="line">        {reverse_pretty_stacktrace, true},      <span class="comment">% ç¿»è½¬å †æ ˆè¾“å‡ºé¡ºåº</span></span><br><span class="line">        {error_logger_redirect, true},          <span class="comment">% æ˜¯å¦é‡å®šå‘error_loggeræ¶ˆæ¯</span></span><br><span class="line">        {error_logger_hwm, <span class="number">50</span>},                 <span class="comment">% error_loggeræ¶ˆæ¯çš„é«˜æ°´ä½çº¿ï¼Œè¶…è¿‡å°†è¢«ä¸¢å¼ƒ å¦‚æœæƒ³è¦ç¼“å­˜ä¸€å®šæ•°é‡æ¶ˆæ¯ï¼Œåˆ™å¼€å¯ä¸‹é¢çš„å±æ€§</span></span><br><span class="line">        <span class="comment">% {error_logger_flush_queue, true},       % å¼€å¯ä¸¢å¼ƒæ¶ˆæ¯ é»˜è®¤ï¼štrue</span></span><br><span class="line">        <span class="comment">% {error_logger_flush_threshold, 1000},   % å½“æ¶ˆæ¯è¶…è¿‡é«˜æ°´ä½çº¿æ—¶ï¼Œå¹¶ä¸”è¶…è¿‡æ­¤ä¸Šçº¿æ—¶ï¼Œè¶…è¿‡çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒ é»˜è®¤ï¼š0</span></span><br><span class="line"></span><br><span class="line">        {async_threshold, <span class="number">20</span>},              <span class="comment">% å½“æ—¥å¿—æ¶ˆæ¯ç§¯ç´¯åˆ°ä¸€å®šæ•°é‡æ—¶åˆ‡æ¢åˆ°åŒæ­¥æ¨¡å¼ï¼ˆåå‹ï¼‰è®¾ç½®ä¸ºundefinedç¦ç”¨    å¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰</span></span><br><span class="line">        {async_threshold_window, <span class="number">5</span>},        <span class="comment">% æ¡£æ—¥å¿—æ¶ˆæ¯å‡å°‘åˆ°ä¸€å®šæ•°é‡æ—¶åˆ‡æ¢åˆ°å¼‚æ­¥æ¨¡å¼  æ¯”å¦‚è¿™é‡Œå°±æ˜¯20 - 5 = 15 å½“æ¶ˆæ¯å°‘äº15æ—¶åˆ‡å›å¼‚æ­¥  å¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰</span></span><br><span class="line">        <span class="comment">% {flush_queue, true}                 % åŠŸèƒ½ä¸ error_logger_flush_queue ä¸€æ · å¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰ é»˜è®¤ï¼štrue</span></span><br><span class="line">        <span class="comment">% {flush_threshold, 1000}             % åŠŸèƒ½ä¸ error_logger_flush_threshold ä¸€æ · å¯ä»¥å•ç‹¬åœ¨sinkä¸­å®šä¹‰ é»˜è®¤ï¼š0</span></span><br><span class="line"></span><br><span class="line">        {handlers, [</span><br><span class="line">            <span class="comment">%% lager_console_backend å¯è®¾ç½®å‚æ•°</span></span><br><span class="line">            <span class="comment">%% level æ—¥å¿—çº§åˆ«ï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% formatter æ ¼å¼åŒ–æ¨¡å— é»˜è®¤ï¼šlager_default_formatter</span></span><br><span class="line">            <span class="comment">%% formatter_config æ—¥å¿—æ ¼å¼ï¼Œé»˜è®¤ï¼š[time, " ", color, "[", severity,"] ", message]</span></span><br><span class="line">            <span class="comment">%% user_stderr æ˜¯å¦ä½¿ç”¨stderr é»˜è®¤ï¼šfalse</span></span><br><span class="line">            <span class="comment">%% group_leader æŒ‡å®šè¦è¾“å‡ºçš„io_server é»˜è®¤ï¼šfalse ä½¿ç”¨userè¿›ç¨‹ä½œä¸ºio_server</span></span><br><span class="line">            {lager_console_backend, [</span><br><span class="line">                {level, debug},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]},</span><br><span class="line"></span><br><span class="line">            <span class="comment">%% lager_file_backend å¯è®¾ç½®å‚æ•°</span></span><br><span class="line">            <span class="comment">%% file æ—¥å¿—æ–‡ä»¶åï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% level æ—¥å¿—çº§åˆ« é»˜è®¤ï¼š&gt;=info</span></span><br><span class="line">            <span class="comment">%% size æ—¥å¿—æ–‡ä»¶å¤§å° é»˜è®¤ï¼š10MB</span></span><br><span class="line">            <span class="comment">%% date æ—¥å¿—åˆ‡å‰²æ—¶é—´ é»˜è®¤ï¼š$D0 æ¯æ—¥0ç‚¹</span></span><br><span class="line">            <span class="comment">%% count æ—¥å¿—åˆ‡åˆ†æ•°é‡ é»˜è®¤ï¼š5</span></span><br><span class="line">            <span class="comment">%% rotation æ—¥å¿—åˆ‡å‰²å¤„ç†æ¨¡å— é»˜è®¤ï¼šlager_rotator_default</span></span><br><span class="line">            <span class="comment">%% formatter æ ¼å¼åŒ–æ¨¡å— é»˜è®¤ï¼šlager_default_formatter</span></span><br><span class="line">            <span class="comment">%% formatter_config æ—¥å¿—æ ¼å¼ï¼ˆéœ€è¦å®šä¹‰ï¼‰</span></span><br><span class="line">            <span class="comment">%% sync_on ç«‹å³åŒæ­¥æ—¥å¿—çº§åˆ« é»˜è®¤ï¼šerror</span></span><br><span class="line">            <span class="comment">%% sync_interval æ—¥å¿—å†™æ–‡ä»¶é—´éš” é»˜è®¤ï¼š1000æ¯«ç§’</span></span><br><span class="line">            <span class="comment">%% sync_size æ—¥å¿—å†™æ–‡ä»¶å¤§å° é»˜è®¤ï¼š64KB</span></span><br><span class="line">            {lager_file_backend, [</span><br><span class="line">                {file, <span class="string">"error.log"</span>},</span><br><span class="line">                {level, '&gt;=error'},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]},</span><br><span class="line">            {lager_file_backend, [</span><br><span class="line">                {file, <span class="string">"info.log"</span>},</span><br><span class="line">                {level, '&lt;=warning'},</span><br><span class="line">                {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">            ]}</span><br><span class="line">        ]},</span><br><span class="line"></span><br><span class="line">        <span class="comment">% {killer_hwm, 1000},               % å¦‚æœæ¶ˆæ¯é«˜æ°´ä½çº¿è¶…è¿‡æ­¤å€¼ åˆ™åˆ æ‰ç›¸å…³æ¥æ”¶å™¨è¿›ç¨‹ é»˜è®¤ï¼šundefined</span></span><br><span class="line">        <span class="comment">% {killer_reinstall_after, 5000}    % è¾¾åˆ°æ­¤æ—¶é—´åé‡å¯æ­¤æ¥æ”¶å™¨è¿›ç¨‹    é»˜è®¤ï¼š5000æ¯«ç§’</span></span><br><span class="line">        {extra_sinks, [</span><br><span class="line">            {msg_lager_event, [</span><br><span class="line">                {handlers, [</span><br><span class="line">                    {lager_file_backend, [</span><br><span class="line">                        {file, <span class="string">"msg.log"</span>},</span><br><span class="line">                        {level, '=info'},</span><br><span class="line">                        {formatter_config, [time, <span class="string">" "</span>, <span class="string">"["</span>, serverity, <span class="string">"]"</span>, module, <span class="string">":"</span>, function, <span class="string">" "</span>, message, <span class="string">"\n"</span>]}</span><br><span class="line">                    ]}</span><br><span class="line">                ]}</span><br><span class="line">            ]}</span><br><span class="line">        ]}</span><br><span class="line">    ]}</span><br><span class="line">].</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p><a href="https://github.com/erlang-lager/lager#custom-formatting">è‡ªå®šä¹‰è¾“å‡ºæ ·å¼</a></p>
</li>
<li><p><a href="https://github.com/erlang-lager/lager#internal-log-rotation">æ—¥å¿—åˆ‡åˆ†ç­–ç•¥</a></p>
</li>
<li><p><a href="https://github.com/erlang-lager/lager#colored-terminal-output">ç»ˆç«¯å½©è‰²è¾“å‡º</a></p>
</li>
<li><p><a href="https://hex.pm/packages?_utf8=%E2%9C%93&amp;search=lager&amp;sort=recent_downloads">å…¶ä»– lager åç«¯</a></p>
</li>
</ul>
<h4 id="2ã€lagerçš„æ—¥å¿—ç­‰çº§åˆ’åˆ†"><a href="#2ã€lagerçš„æ—¥å¿—ç­‰çº§åˆ’åˆ†" class="headerlink" title="2ã€lagerçš„æ—¥å¿—ç­‰çº§åˆ’åˆ†"></a>2ã€lager çš„æ—¥å¿—ç­‰çº§åˆ’åˆ†</h4><p>ä»ä½åˆ°é«˜åˆ†åˆ«ä¸ºï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">debug &lt; info &lt; notice &lt; warning &lt; error &lt; critical &lt; alter &lt; emergency</span><br></pre></td></tr></tbody></table></figure>

<p>lager æ”¯æŒç±»ä¼¼ syslog å½¢å¼å®šä¹‰çº§åˆ«ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line">info        % infoåŠæ›´é«˜çº§åˆ«ï¼ˆ&gt;=info éšå¼ï¼‰</span><br><span class="line">=debug      % åªæœ‰debugçº§åˆ«</span><br><span class="line">!=info      % é™¤äº†infoçº§åˆ«ä»¥å¤–çš„æ‰€æœ‰çº§åˆ«</span><br><span class="line">&lt;=notice    % noticeåŠæ›´ä½çº§åˆ«</span><br><span class="line">&lt;warning    % ä»»ä½•å°äºwarningçš„çº§åˆ«</span><br></pre></td></tr></tbody></table></figure>



<h4 id="3ã€ä½¿ç”¨æŠ€å·§"><a href="#3ã€ä½¿ç”¨æŠ€å·§" class="headerlink" title="3ã€ä½¿ç”¨æŠ€å·§"></a>3ã€ä½¿ç”¨æŠ€å·§</h4><ul>
<li><p>ä½¿ç”¨è‡ªå®šä¹‰ sink</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">-define</span><span class="params">(MSG(Args)</span>, msg:info<span class="params">(Args)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(MSG(Format, Args)</span>, msg:info<span class="params">(Format, Args)</span>).</span><br><span class="line"><span class="keyword">-define</span><span class="params">(MSG(Attr, Format, Args)</span>, msg:info<span class="params">(Attr, Format, Args)</span>).</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">msg</span><span class="params">(Args)</span> -&gt;</span></span><br><span class="line">    ?MSG(Args).</span><br><span class="line"><span class="function"><span class="title">msg</span><span class="params">(Format, Args)</span> -&gt;</span></span><br><span class="line">    ?MSG(Format, Args).</span><br><span class="line"><span class="function"><span class="title">msg</span><span class="params">(Attr, Format, Args)</span> -&gt;</span></span><br><span class="line">    ?MSG(Attr, Format, Args).</span><br></pre></td></tr></tbody></table></figure>

</li>
<li><p>æ‰©å±• sink æ‰“å°çš„æ—¥å¿—ä¸ä¼šæ˜¾ç¤ºåˆ° console</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">%% sink_lager_event ä¸ºè‡ªå®šä¹‰sink</span></span><br><span class="line"><span class="comment">%% æ·»åŠ handler</span></span><br><span class="line"><span class="number">1</span>&gt; gen_event:add_handler(sink_lager_event, lager_console_backend, [{level, info}]).    </span><br><span class="line">ok</span><br><span class="line"><span class="comment">%% åˆ é™¤handler</span></span><br><span class="line"><span class="number">2</span>&gt; gen_event:delete_handler(sink_lager_event, lager_console_backend, [{level, info}]).</span><br><span class="line">ok</span><br></pre></td></tr></tbody></table></figure>

</li>
</ul>
<h2 id="æ—¥å¿—æ‰©å±•"><a href="#æ—¥å¿—æ‰©å±•" class="headerlink" title="æ—¥å¿—æ‰©å±•"></a>æ—¥å¿—æ‰©å±•</h2><h2 id="æ—¥å¿—æ ¼å¼åŒ–"><a href="#æ—¥å¿—æ ¼å¼åŒ–" class="headerlink" title="æ—¥å¿—æ ¼å¼åŒ–"></a>æ—¥å¿—æ ¼å¼åŒ–</h2><h2 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h2><h2 id="error-logger-å¤„ç†"><a href="#error-logger-å¤„ç†" class="headerlink" title="error_logger å¤„ç†"></a>error_logger å¤„ç†</h2><h2 id="è¿‡è½½ä¿æŠ¤"><a href="#è¿‡è½½ä¿æŠ¤" class="headerlink" title="è¿‡è½½ä¿æŠ¤"></a>è¿‡è½½ä¿æŠ¤</h2><h3 id="å¼‚æ­¥æ¨¡å¼"><a href="#å¼‚æ­¥æ¨¡å¼" class="headerlink" title="å¼‚æ­¥æ¨¡å¼"></a>å¼‚æ­¥æ¨¡å¼</h3><h4 id="äº‹ä»¶é˜Ÿåˆ—æ¸…ç†"><a href="#äº‹ä»¶é˜Ÿåˆ—æ¸…ç†" class="headerlink" title="äº‹ä»¶é˜Ÿåˆ—æ¸…ç†"></a>äº‹ä»¶é˜Ÿåˆ—æ¸…ç†</h4><h4 id="æ¥æ”¶å™¨æ€æ‰‹"><a href="#æ¥æ”¶å™¨æ€æ‰‹" class="headerlink" title="æ¥æ”¶å™¨æ€æ‰‹"></a>æ¥æ”¶å™¨æ€æ‰‹</h4><h4 id="è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹"><a href="#è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹" class="headerlink" title="è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹"></a>è¿è¡Œæ—¶æ—¥å¿—çº§åˆ«æ›´æ”¹</h4><ul>
<li><p>æŸ¥çœ‹æ—¥å¿—çº§åˆ«</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">lager:get_loglevel(lager_console_backend).</span><br><span class="line">lager:get_loglevel({lager_file_backend,<span class="string">"info.log"</span>}).</span><br><span class="line">lager:get_loglevel({lager_file_backend,<span class="string">"error.log"</span>}).</span><br><span class="line">lager:get_loglevel(msg_lager_event, {lager_file_backend,<span class="string">"sink.log"</span>}).</span><br></pre></td></tr></tbody></table></figure>

</li>
<li><p>è®¾ç½®æ—¥å¿—çº§åˆ«</p>
  <figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">lager:set_loglevel(lager_console_backend,'info'). </span><br><span class="line">lager:set_loglevel({lager_file_backend, <span class="string">"info.log"</span>},'debug').                          </span><br><span class="line">lager:set_loglevel(msg_lager_event, {lager_file_backend, <span class="string">"msg.log"</span>}, undefined, 'info').</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="æ—¥å¿—ç­‰çº§è®¾å®š"><a href="#æ—¥å¿—ç­‰çº§è®¾å®š" class="headerlink" title="æ—¥å¿—ç­‰çº§è®¾å®š"></a>æ—¥å¿—ç­‰çº§è®¾å®š</h4><h4 id="æ—¥å¿—æ–‡ä»¶è½®è½¬"><a href="#æ—¥å¿—æ–‡ä»¶è½®è½¬" class="headerlink" title="æ—¥å¿—æ–‡ä»¶è½®è½¬"></a>æ—¥å¿—æ–‡ä»¶è½®è½¬</h4><p>Lager è‡ªå·±å¯ä»¥å®Œæˆæ—¥å¿—æ–‡ä»¶çš„è½®è½¬ï¼Œæˆ–è€…ç”±å¤–éƒ¨è¿›ç¨‹è´Ÿè´£ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œä½¿ç”¨å…³é”®å˜é‡ dateã€sizeã€count æ·»åŠ åœ¨ backend çš„é…ç½®ä¸­å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">[{file, <span class="string">"error.log"</span>}, {level, error}, {size, <span class="number">10485760</span>}, {date, <span class="string">"$D0"</span>}, {count, <span class="number">5</span>}]</span><br></pre></td></tr></tbody></table></figure>


<p>è¿™å‘Šè¯‰ Lager å°†é”™è¯¯å’Œä»¥ä¸Šæ¶ˆæ¯è®°å½•åˆ° error.log æ–‡ä»¶ï¼Œå¹¶åœ¨åˆå¤œæˆ–åˆ°è¾¾ 10mb æ—¶æ—‹è½¬æ–‡ä»¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œå¹¶åœ¨å½“å‰æ–‡ä»¶ä¹‹å¤–å†ä¿ç•™ 5 ä¸ªæ—‹è½¬çš„æ—¥å¿—ã€‚å°† count è®¾ç½®ä¸º 0 ä¸ä¼šç¦ç”¨æ—‹è½¬ï¼Œè€Œæ˜¯æ—‹è½¬æ–‡ä»¶å¹¶ä¸”ä¸ä¿ç•™ä»¥å‰çš„ç‰ˆæœ¬ã€‚è¦ç¦ç”¨æ—‹è½¬ï¼Œå°†å¤§å°è®¾ç½®ä¸º 0ï¼Œå°†æ—¥æœŸè®¾ç½®ä¸ºâ€â€ã€‚</p>
<p>è¿™å‘Šè¯‰ Lager å°†é”™è¯¯å’Œä»¥ä¸Šæ¶ˆæ¯è®°å½•åˆ° error.log æ–‡ä»¶ï¼Œå¹¶åœ¨åˆå¤œæˆ–åˆ°è¾¾ 10mb æ—¶æ—‹è½¬æ–‡ä»¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œå¹¶åœ¨å½“å‰æ–‡ä»¶ä¹‹å¤–å†ä¿ç•™ 5 ä¸ªæ—‹è½¬çš„æ—¥å¿—ã€‚å°† count è®¾ç½®ä¸º 0 ä¸ä¼šç¦ç”¨æ—‹è½¬ï¼Œè€Œæ˜¯æ—‹è½¬æ–‡ä»¶å¹¶ä¸”ä¸ä¿ç•™ä»¥å‰çš„ç‰ˆæœ¬ã€‚è¦ç¦ç”¨æ—‹è½¬ï¼Œå°†å¤§å°è®¾ç½®ä¸º 0ï¼Œå°†æ—¥æœŸè®¾ç½®ä¸ºâ€â€ã€‚</p>
<p>è¯¥ $D0 è¯­æ³•æ¥è‡ª newsyslog.conf ä¸­ newsyslog ä½¿ç”¨çš„è¯­æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line">Day, week and month time format: The lead-in character</span><br><span class="line">for day, week and month specification is a `$'-sign.</span><br><span class="line">The particular format of day, week and month</span><br><span class="line">specification is: [Dhh], [Ww[Dhh]] and [Mdd[Dhh]],</span><br><span class="line">respectively.  Optional time fields default to</span><br><span class="line">midnight.  The ranges for day and hour specifications</span><br><span class="line">are:</span><br><span class="line">  mm      minutes, range 0 ... 59</span><br><span class="line">  hh      hours, range 0 ... 23</span><br><span class="line">  w       day of week, range 0 ... 6, 0 = Sunday</span><br><span class="line">  dd      day of month, range 1 ... 31, or the</span><br><span class="line">          letter L or l to specify the last day of</span><br><span class="line">          the month.</span><br><span class="line"></span><br><span class="line">Some examples:</span><br><span class="line">  $H00    rotate every hour at HH:00</span><br><span class="line">  $D0     rotate every night at midnight</span><br><span class="line">  $D23    rotate every day at 23:00 hr</span><br><span class="line">  $D12H30 rotate every day at 12:30</span><br><span class="line">  $W0D23  rotate every week on Sunday at 23:00 hr</span><br><span class="line">  $W5D16  rotate every week on Friday at 16:00 hr</span><br><span class="line">  $W0D0H0 rotate every week on Sunday at 00:00</span><br><span class="line">  $M1D0   rotate on the first day of every month at</span><br><span class="line">          midnight (i.e., the start of the day)</span><br><span class="line">  $M5D6   rotate on every 5th day of the month at</span><br><span class="line">          6:00 hr</span><br></pre></td></tr></tbody></table></figure>



<h4 id="å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨"><a href="#å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨" class="headerlink" title="å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨"></a>å®šåˆ¶çš„æ—¥å¿—è½®è½¬å™¨</h4><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®é¡¹å®šä¹‰ lager_file_backend è‡ªå®šä¹‰æ—¥å¿—å¾ªç¯å™¨</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line">{rotator, lager_rotator_default}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯¥æ¨¡å—åº”è¯¥æ˜¯ä¸€ä¸ª lager_rotator_behaviour, ä¹Ÿå°±æ˜¯åº”æä¾›ä»¥ä¸‹å›è°ƒï¼š</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">%% @doc Create a log file</span></span><br><span class="line">-callback<span class="params">(create_logfile(Name::list(), Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Open a log file</span></span><br><span class="line">-callback<span class="params">(open_logfile(Name::list(), Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Ensure reference to current target, could be rotated</span></span><br><span class="line">-callback<span class="params">(ensure_logfile(Name::list(), FD::file:io_device(), Inode::integer(),</span></span><br><span class="line"><span class="params">                         Buffer::{integer(), integer()} | any()) -&gt;</span></span><br><span class="line"><span class="params">    {ok, {FD::file:io_device(), Inode::integer(), Size::integer()}} | {error, any()})</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment">%% @doc Rotate the log file</span></span><br><span class="line">-callback<span class="params">(rotate_logfile(Name::list(), Count::integer()) -&gt;</span></span><br><span class="line"><span class="params">    ok)</span>.</span><br></pre></td></tr></tbody></table></figure>



<h4 id="æ‰“å°å¼‚å¸¸-exception"><a href="#æ‰“å°å¼‚å¸¸-exception" class="headerlink" title="æ‰“å°å¼‚å¸¸ - exception"></a>æ‰“å°å¼‚å¸¸ - exception</h4><p>OTP 21+</p>
<figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">    foo()</span><br><span class="line"><span class="keyword">catch</span></span><br><span class="line">    Class:Reason:Stacktrace -&gt;</span><br><span class="line">        lager:error(</span><br><span class="line">            <span class="string">"~nStacktrace:~s"</span>,</span><br><span class="line">            [lager:pr_stacktrace(Stacktrace, {Class, Reason})])</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></tbody></table></figure>



<h4 id="æ‰“å°è®°å½•-record"><a href="#æ‰“å°è®°å½•-record" class="headerlink" title="æ‰“å°è®°å½• - record"></a>æ‰“å°è®°å½• - record</h4><figure class="highlight erlang"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span>&gt; lager:info(<span class="string">"My state is ~p"</span>, [lager:pr(State, ?MODULE)]).</span><br><span class="line">My state is #state{}</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>&gt; lager:info(<span class="string">"My state is ~p"</span>,[State]).</span><br><span class="line">My state is {state}</span><br></pre></td></tr></tbody></table></figure>



<h4 id="å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º"><a href="#å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º" class="headerlink" title="å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º"></a>å¸¦è‰²å½©çš„æ§åˆ¶å°è¾“å‡º</h4><h4 id="åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶"><a href="#åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶" class="headerlink" title="åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶"></a>åœ¨ç¼–è¯‘æ—¶è®¾ç½®æˆªæ–­é™åˆ¶</h4><h4 id="ç¦æ­¢applications-å’Œ-supervisorså¯åŠ¨-åœæ­¢æ—¥å¿—"><a href="#ç¦æ­¢applications-å’Œ-supervisorså¯åŠ¨-åœæ­¢æ—¥å¿—" class="headerlink" title="ç¦æ­¢applications å’Œ supervisorså¯åŠ¨/åœæ­¢æ—¥å¿—"></a>ç¦æ­¢ applications å’Œ supervisors å¯åŠ¨ / åœæ­¢æ—¥å¿—</h4><h4 id="æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode"><a href="#æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode" class="headerlink" title="æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ªNode"></a>æ§åˆ¶å°è¾“å‡ºåˆ°å¦ä¸€ä¸ª Node</h4>]]></content>
      <tags>
        <tag>erlang</tag>
        <tag>log</tag>
      </tags>
  </entry>
  <entry>
    <title>é‚£äº›æ­Œ</title>
    <url>/2021/04/15/%E9%82%A3%E4%BA%9B%E6%AD%8C/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h5 id="x1f442-ç½‘æ˜“äº‘"><a href="#x1f442-ç½‘æ˜“äº‘" class="headerlink" title="ğŸ‘‚ç½‘æ˜“äº‘"></a><span class="github-emoji" alias="ear" style="" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f442.png?v8">ğŸ‘‚</span>ç½‘æ˜“äº‘</h5>
    <div id="aplayer-tuUbJOvC" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="6647556685" data-server="netease" data-type="playlist" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"></div>

<p>å‡­ä»€ä¹ˆæ•¢æŒ¡åœ¨æœ€å‰é¢ï¼Ÿ</p>
]]></content>
      <tags>
        <tag>essay</tag>
      </tags>
  </entry>
</search>
